Статус: Полная деконструкция завершена.
Источник: 536626_Automatisiertes_Hochregal.rpp
ГЛАВА 1: ОБЩАЯ АРХИТЕКТУРА И ТОЧКИ ВХОДА
1.1. Hauptprogramm (Основная программа):
Назначение: Является полуавтоматической панелью управления, а не автономным циклом.
Логика:
Инициализация: При старте однократно вызывает подпрограмму Kalibrierung (физическая калибровка осей).
Ожидание ввода пользователя: В параллельном процессе ожидает нажатия одной из трех виртуальных кнопок (W, R, B) на панели управления.
Запись выбора: При нажатии кнопки записывает в глобальную переменную Button числовой код (1, 2 или 3).
Ожидание триггера: В основном цикле ожидает срабатывания датчика I1 (phototransistor outside).
Запуск сценария: После срабатывания I1 вызывает основную подпрограмму-сценарий einlagern (хранить).
Ключевой вывод: Система не идентифицирует груз автоматически. Тип операции задается оператором вручную.
1.2. Kalibrierung (Калибровка):
Назначение: Является модулем физической калибровки (Homing). Вызывается один раз при старте Hauptprogramm.
Логика: Состоит из последовательного вызова трех подпрограмм для установки каждой оси в нулевое положение: HRL Position Z0 (возврат консоли), HRL Position Y (подъем каретки) и HRL Position X (возврат к началу).
ГЛАВА 2: НИЗКОУРОВНЕВЫЕ МОДУЛИ УПРАВЛЕНИЯ (ДРАЙВЕРЫ)
2.1. HRL Position Z0 (Консоль Назад):
Назначение: Возвращает консоль (ось Z) в заднее положение до упора.
Логика:
Подает команду ccw (назад) на мотор M3.
Ждет срабатывания заднего концевого выключателя I6 (сигнал 1).
Подает команду Stop на мотор M3.
Примечание: Использует базовые блоки управления мотором.
2.2. HRL Position Z1 (Консоль Вперед):
Назначение: Выдвигает консоль (ось Z) вперед до упора.
Логика:
Подает команду cw (вперед) на мотор M3.
Ждет срабатывания переднего концевого выключателя I7 (сигнал 1).
Подает команду Stop на мотор M3.
2.3. PosEM (Универсальный движок позиционирования):
Назначение: Ключевой модуль. Является универсальным, параметризованным "движком" для перемещения любой оси с энкодером в заданную координату и калибровки.
Интерфейс (API):
Входы:
End (Endschalter): Порт концевого выключателя.
Ist (Ist-Position): Текущая позиция (передается с выхода "движка" для обратной связи).
Soll (Soll-Position): Целевая координата.
Count (Counter): Порт счетчика энкодера.
Target (Target reached): Порт виртуального входа MxE.
Выходы:
Ist (Ist-Position): Выдает текущую позицию энкодера.
Motor: Выдает управляющие команды (Вправо, Влево, Стоп, Дистанция) для подключения к оранжевому блоку "Мотор".
Логика:
Калибровка (если Soll = 0): Если целевая позиция равна 0, запускается процедура Homing. "Движок" движется в сторону концевика, ждет его срабатывания (End > 0), останавливается, а затем вызывает подпрограмму EndEM для коррекции "перебега" и точной установки нуля.
Движение по координате (если Soll != 0):
Сравнивает Soll и Ist.
Если Soll > Ist, вычисляет дистанцию Soll - Ist и отдает команду Distance с направлением Вправо на выход Motor.
Если Soll < Ist, вычисляет дистанцию Ist - Soll и отдает команду Distance с направлением Влево на выход Motor.
Ждет сигнала о завершении движения на входе Target (MxE).
2.4. EndEM (Коррекция перебега):
Назначение: Вспомогательный модуль для PosEM. Компенсирует инерционный "перебег" мотора после срабатывания концевого выключателя.
Логика:
Сбрасывает счетчик энкодера командой Reset.
Ждет полной остановки мотора (0.4s).
Считывает значение "перебега" со счетчика.
Отдает команду Distance на движение в обратную сторону на величину "перебега".
Сбрасывает режим Distance командой Distance 0 (что одновременно является аппаратным сбросом счетчика в ноль).
Аномалия: Использует команду Reset для сброса счетчика, что, согласно нашей Базе Знаний, не обнуляет аппаратный счетчик, а лишь сбрасывает режим. Однако Distance 0 в конце исправляет ситуацию.
2.5. HRL Position X/Y (Адаптеры):
Назначение: Являются "адаптерами", соединяющими универсальный "движок" PosEM с конкретным оборудованием осей X и Y.
Логика HRL Position Y:
Получает целевую координату на вход Y.
Подключает к PosEM: I8 (концевик), C2C (энкодер), M2E (сигнал завершения).
Подключает выход Motor из PosEM к физическому мотору M2.
ГЛАВА 3: ВЫСОКОУРОВНЕВЫЕ МОДУЛИ (СЦЕНАРИИ И ЛОГИКА)
3.1. Regalpositionen (Маршрутизатор координат):
Назначение: Принимает числовые коды ряда (Reihe) и уровня (Ebene) и выдает соответствующие абсолютные координаты X и Y.
Логика: Каскад из блоков Разветвление.
Если Reihe = 1, то X = X_1 (760).
Если Ebene = 1, то Y = Y_1 (73).
Вызывает HRL Position X/Y для физического перемещения.
3.2. RegalFüllen (Заполнить полки / Поиск места):
Назначение: Логический модуль. Определяет, на какой уровень (Ebene) и в какой ряд (Regal) нужно поместить палету заданного цвета (Farbe).
Логика:
Принимает на вход Farbe (1=W, 2=R, 3=B).
Определяет целевой уровень (Ebene).
В цикле от 1 до 3 ищет первую свободную ячейку на этом уровне, обращаясь к списку (массиву) Regalbefüllung.
Выдает на выходы Ebene (номер уровня) и Regal (номер ряда).
Если свободных ячеек нет, выходит через Leer (Пусто).
3.3. RegalManagement (Управление складом):
Назначение: Математический модуль для работы с картой склада.
Логика:
Принимает на вход Regal (ряд) и Etage (уровень).
По формуле (Etage - 1) * 3 + (Regal - 1) вычисляет индекс ячейки в одномерном списке Regalbefüllung.
Принимает Value (0=свободно, 1=занято) и записывает это значение в ячейку списка по вычисленному индексу.
3.4. einlagern / ausgeben (Сценарии "Складировать" / "Выдать"):
Назначение: Высокоуровневые "дирижеры", которые вызывают все остальные подпрограммы в правильной последовательности для выполнения полного технологического цикла.
Пример логики einlagern:
Вызвать Zustellen (подать палету к зоне сканирования).
Вызвать RegalFüllen (найти свободное место на основе цвета).
Вызвать Regalpositionen (переместить пустой штабелер к конвейеру (X_0, Y_0)).
Вызвать Aufnehmen_Band (подобрать палету с ленты).
Вызвать Regalpositionen (переместить штабелер с палетой к найденной ячейке (X_n, Y_n)).
Вызвать Absetzen (оставить палету в ячейке).
Вызвать RegalManagement (обновить карту склада, пометив ячейку как занятую).

<!-- [ARK_INTEGRITY_CHECKSUM::sha256:3744d738c259938ff97e891a00155f7f1fd59e4fa25b8cfd2a704e1cdb50c938] -->