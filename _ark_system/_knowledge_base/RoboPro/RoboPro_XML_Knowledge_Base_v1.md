# База Знаний RoboPro XML vFINAL_R2

Этот документ описывает структуру и ключевые элементы XML-файлов `.rpp` для их однозначной и безошибочной интерпретации.

## 1. Фундаментальная структура
- **`<cvg classname="ftProDrawDcmt">`**: Корневой элемент документа.
- **`<o classname="ftProSubroutineFunction" name="..." guid="...">`**: Определяет одну подпрограмму.
- **`<ftProModule name="...">`**: Конфигурационный тег, определяет используемые контроллеры. Не влияет на исполняемую логику.

## 2. Элементы Потока Управления (Синие линии)
- **`<o classname="ftProProcessStart">`**: Блок "Старт".
- **`<o classname="ftProProcessStop">`**: Блок "Стоп".
- **`<o classname="ftProFlowIf" ...>`**: Блок "Цифровое разветвление".
  - **Вариация 1 (с `input`):** Проверяет состояние физического порта. `input="160"` -> **I1**, `input="161"` -> **I2**, `input="162"` -> **I3**, **`input="163"` -> I4**.
  - **Вариация 2 (без `input`, `style="1"`):** Получает данные для сравнения с константой (например, `0`) через оранжевый вход `A`. В свойствах можно выбрать условие (`>=`, `>`, `<`, `=`, `!=`).
- **`<o classname="ftProFlowWaitChange">`**: Блок "Ожидание изменения".
- **`<o classname="ftProFlowDelay" uservalue="...">`**: Блок "Пауза". `uservalue` в секундах.
- **`<o classname="ftProFlowCmpr2">`**: Блок "Сравнение A?B" с тремя выходами: `<`, `=`, `>`.

## 3. Элементы Данных и Команд (Оранжевые линии)
- **`<o classname="ftProDataVariable" name="...">`**: Переменная.
- **`<o classname="ftProDataConst" value="...">`**: Константа.
- **`<o classname="ftProDataOprt" operation="...">`**: Арифметический Оператор (`+`, `-`).
- **`<o classname="ftProDataMssg" command="..." value="...">`**: **Генератор Команд.** Создает пакет данных. `command` может быть `cw`, `ccw`, `Stop`, `Distance`, `Reset`, **`Сброс`**.
- **`<o classname="ftProDataText" text="...">`**: Текстовая константа.

## 4. Элементы Подпрограмм
- **`<o classname="ftProSubroutineRef" name="..." guid="...">`**: **Вызов Подпрограммы.**
- **`<o classname="ftProSubroutineFlowIn">`**: Точка Входа потока управления.
- **`<o classname="ftProSubroutineFlowOut">`**: Точка Выхода потока управления.
- **`<o classname="ftProSubroutineDataIn" name="...">`**: Информационный Вход для данных.
- **`<o classname="ftProSubroutineDataOut" name="...">`**: Информационный Выход для данных.

## 5. Элементы Взаимодействия с Оборудованием
- **`<o classname="ftProDataOutDual" output="...">`**: **Исполнитель** команд для мотора. `output="0"` -> **M1**, `output="1"` -> **M2**, `output="2"` -> **M3**.
- **`<o classname="ftProDataOutDualEx" ...>`**: Комбинированный блок **"Движение на дистанцию"**. `output1` задает мотор. **Дистанция задается статически** в свойстве `distance` и **не может быть подана динамически**.
- **`<o classname="ftProDataOutSngl" output="..." command="...">`**: Исполнитель команд для клапана/лампы. `output="6"` -> **O7**, `output="7"` -> **O8**.
- **`<o classname="ftProDataIn" input="..." inputMode="...">`**: Чтение данных с порта.
  - `input="176"`, `inputMode="6"` -> **C1C**
  - `input="177"`, `inputMode="6"` -> **C2C**
  - `input="178"`, `inputMode="6"` -> **C3C**
  - `input="192"`, `inputMode="8"` -> **M1E**
  - `input="193"`, `inputMode="8"` -> **M2E**
  - `input="194"`, `inputMode="8"` -> **M3E**
  - `input="96"`, `inputMode="8"` -> Чтение с **экранной кнопки**.

## 6. Вспомогательные теги (Игнорировать при анализе логики)
- Все теги `wxCanvas...`, `properties`, `xy`, `ftPro...Panel/Display/Camera/Symbol`.
[УТОЧНЕНО] ГЛАВА 3.4: Блоки Управления Движением
Команда "Дистанция 0": Статус этого знания повышен до "КРИТИЧЕСКИ ВАЖНЫЙ". Добавляется примечание: "ЭТО ЕДИНСТВЕННЫЙ ДОСТОВЕРНЫЙ СПОСОБ АППАРАТНОГО ОБНУЛЕНИЯ СЧЕТЧИКА ЭНКОДЕРА. ПРИМЕНЯЕТСЯ В ПРОЦЕДУРАХ КАЛИБРОВКИ СРАЗУ ПОСЛЕ ОСТАНОВКИ ПО СИГНАЛУ С КОНЦЕВОГО ВЫКЛЮЧАТЕЛЯ."
[НОВОЕ ЗНАНИЕ] Команда "Сброс" (Reset):
Назначение: Отмена предварительно установленных режимов расширенного управления ("Дистанция", "Синхронно").
Функция: Возвращает исполнитель мотора (ftProDataOutDual) в базовый режим прямого управления скоростью.
Ключевое ограничение: НЕ ОБНУЛЯЕТ аппаратный счетчик энкодера. Использование этой команды в процедурах калибровки является КРИТИЧЕСКОЙ ОШИБКОЙ.
Сценарий применения: Рекомендуется для процедур аварийной остановки, чтобы "очистить память" исполнителя от невыполненных команд на движение.

<!-- [ARK_INTEGRITY_CHECKSUM::sha256:0a7d58e68028e5affee041343ddcea54cf58a1aa64a885e22a33c09d0c7e957d] -->